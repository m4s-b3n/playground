name: Test Secret Override

on:
  workflow_call:
    inputs:
      environment:
        type: string
        description: 'Environment to run the job'
        required: false
      variable:
        type: string
        description: 'Variable to override'
        required: false
    secrets: 
      TEST_SECRET:
        description: 'Secret to override'
        required: false

jobs:
  test:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    env:
      TEST_VAR: ${{ inputs.variable }}
      TEST_VAR_ENV: ${{ vars.TEST }}
      TEST_VAR_SELECTED: ${{ inputs.variable || vars.TEST }}
      TEST_SECRET: ${{ secrets.TEST_SECRET }}
      TEST_SECRET_ENV: ${{ secrets.TEST_SECRET_ENV }}
      SELECTED_SECRET: ${{ secrets.TEST_SECRET || secrets.TEST_SECRET_ENV }}
    steps:
      - name: Test Variable
        run: |
          echo "INPUT: $TEST_VAR"
          echo "ENV: $TEST_VAR_ENV"
          echo "SELECTED: $TEST_VAR_SELECTED"
      - name: Test Secret
        run: |
          echo "INPUT: $(echo $TEST_SECRET | base64 -w 0)"
          echo "ENV: $(echo $TEST_SECRET_ENV | base64 -w 0)"
          echo "SELECTED: $(echo $SELECTED_SECRET | base64 -w 0)"
